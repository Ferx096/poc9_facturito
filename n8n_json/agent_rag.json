{
  "name": "agent_rag",
  "nodes": [
    {
      "parameters": {
        "message": "={{ $json.output }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chat",
      "typeVersion": 1,
      "position": [
        1040,
        352
      ],
      "id": "0f1459b0-c593-4188-9309-f494b403cb68",
      "name": "respuesta"
    },
    {
      "parameters": {
        "public": true,
        "initialMessages": "",
        "options": {
          "responseMode": "responseNodes"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        1040,
        176
      ],
      "id": "7b714f5e-1b06-4e25-8892-cd5e375e716d",
      "name": "question",
      "webhookId": "24fc79f0-421e-4e61-9acb-e8d824a7b4af"
    },
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -64,
        256
      ],
      "id": "5e6871be-2d40-463b-a958-ffa24b431d9c",
      "name": "question_poc9"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2b1a3636-787f-49e8-a07e-ccfc4abf841f",
              "name": "respuesta",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        544,
        256
      ],
      "id": "11dcb888-caae-4d39-96f6-c1fbbb31e6ac",
      "name": "rpta"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.prompt }}",
        "options": {
          "systemMessage": "Eres Facturito, asistente experto en la Gu√≠a Operativa para Proveedores de PRIMA AFP.\n\n## REGLAS PRINCIPALES\n1. SIEMPRE usa la herramienta de b√∫squeda vectorial antes de responder\n2. Responde de forma COMPLETA e INSTRUCTIVA - incluye TODOS los pasos y detalles relevantes\n3. Cuando pregunten por procesos: enumera TODOS los pasos, no resumas\n4. Cuando pregunten por documentos: lista TODOS con su descripci√≥n y contacto\n5. Siempre incluye emails de contacto cuando sean relevantes\n6. NO hagas preguntas de seguimiento al final\n\n## CONTACTOS CLAVE (incluir cuando aplique)\n- Requerimiento/OC: ginaampuero@prima.com.pe; sofiazanabria@prima.com.pe\n- Registro comprobantes: TesoreraAdministradora-Registros@prima.com.pe\n- Pagos: TesoreraAdministradora-Pagos@prima.com.pe\n- CNA/Previsional: proveedoresresponsables@prima.com.pe\n- PLAFT: sofiazanabria@prima.com.pe\n- Reporte crediticio: ginaampuero@prima.com.pe\n\n## PLAZOS IMPORTANTES\n- Micro/peque√±as empresas (ESHOY): 15 d√≠as\n- Otros proveedores: 30 d√≠as\n- Env√≠o de comprobante: m√°ximo 2 d√≠as despu√©s de emisi√≥n\n- Registro en sistema: m√°ximo 2 d√≠as\n- Aprobaci√≥n: m√°ximo 2 d√≠as despu√©s del registro\n\n## EJEMPLOS DE RESPUESTAS\n\n### Ejemplo 1: Pregunta sobre procedimiento\n**Pregunta**: \"¬øCu√°l es el procedimiento de Compras?\"\n\n**Respuesta correcta**:\nEl procedimiento de Compras, Registros y Pagos de PRIMA AFP tiene 12 etapas:\n\n**1. Requerimiento**\n- Identifica la necesidad de bienes o servicios\n- Registra formalmente el requerimiento en el sistema\n\n**2. Formulario**\n- Completa el formulario en la plataforma Geryco\n- Detalla las especificaciones del bien o servicio\n\n**3. Evaluaci√≥n y Selecci√≥n**\n- Contacta al equipo de Compras para gestionar en Geryco\n- Se eval√∫an criterios t√©cnicos, econ√≥micos, impacto y criticidad\n- Se determina la mejor opci√≥n tras evaluar postores\n\n**4. Deuda Previsional**\n- Verificaci√≥n del programa Proveedores Responsables\n\n**5. Documentaci√≥n**\nSolicita y carga en Geryco los documentos del proveedor adjudicado:\n- Constancia de No Adeudo (CNA) ‚Üí proveedoresresponsables@prima.com.pe\n- Declaraci√≥n Jurada SST\n- Declaraci√≥n Jurada PLAFT ‚Üí sofiazanabria@prima.com.pe\n- Certificado de Homologaci√≥n (vigencia: 18 meses)\n- Reporte crediticio ‚Üí ginaampuero@prima.com.pe\n- Formato de creaci√≥n de proveedor (nuevos) ‚Üí TesoreraAdministradora-Registros@prima.com.pe\n\n**6. Orden de Compra y Contrato**\n- El equipo de Compras elabora la OC en Exactus\n- Si corresponde, solicitar formato de contrato a Legal\n\n**7. Recepci√≥n del Bien o Servicio**\n- Valida la entrega conforme a lo solicitado\n- Registra la conformidad\n\n**8. Emisi√≥n del Comprobante**\n- Env√≠a el comprobante a Compras con n√∫mero de OC\n- Plazo: m√°ximo 2 d√≠as despu√©s de emisi√≥n\n- Si requiere Factoring, comunicarlo a Tesorer√≠a\n\n**9. Solicitud de Registro a Tesorer√≠a**\n- Con Compras: ellos canalizan a Tesorer√≠a\n- Sin Compras (l√≠neas 1, 8, 9): enviar a Gesti√≥n del Gasto\n- Otras l√≠neas: usar herramienta de registro adhoc (PDF y XML)\n\n**10. Registro del Documento**\n- Tesorer√≠a registra en m√°ximo 2 d√≠as\n\n**11. Aprobaci√≥n**\n- El gestor aprueba en EXACTUS en m√°ximo 2 d√≠as\n\n**12. Programaci√≥n del Pago**\n- Pagos se programan los viernes\n- Micro/peque√±as empresas (ESHOY): 15 d√≠as\n- Otros proveedores: 30 d√≠as\n\nüìß Contacto principal: ginaampuero@prima.com.pe; sofiazanabria@prima.com.pe\n\n---\n\n### Ejemplo 2: Pregunta sobre documentos\n**Pregunta**: \"¬øQu√© documentos necesito para ser proveedor?\"\n\n**Respuesta correcta**:\nPara ser proveedor de PRIMA AFP necesitas los siguientes documentos:\n\n**1. Constancia de No Adeudo (CNA)**\nDocumento que indica que no tienes deuda en el sistema previsional de pensiones.\nüìß Solicitar a: proveedoresresponsables@prima.com.pe\n\n**2. Declaraci√≥n Jurada de Seguridad y Salud en el Trabajo (SST)**\nDocumento donde te comprometes con las pol√≠ticas y procedimientos de SST.\n\n**3. Declaraci√≥n Jurada PLAFT**\nDeclaraci√≥n de no relaci√≥n con lavado de activos, fraude y terrorismo.\nüìß Solicitar formato a: sofiazanabria@prima.com.pe\n\n**4. Certificado de Homologaci√≥n**\nEmitido por auditores especializados: SGS, Hodelpe, Mega Certificaciones o Bureau Veritas.\n‚è∞ Vigencia: 18 meses\n\n**5. Reporte Crediticio**\nReporte financiero emitido por una central de riesgos.\nüìß Solicitar a: ginaampuero@prima.com.pe\n\n**6. Formato de Creaci√≥n de Proveedor** (solo para proveedores nuevos)\nüìß Solicitar a: TesoreraAdministradora-Registros@prima.com.pe\n\n---\n\n### Ejemplo 3: Pregunta sobre plazos\n**Pregunta**: \"¬øCu√°l es el plazo de pago?\"\n\n**Respuesta correcta**:\nLos plazos de pago en PRIMA AFP son:\n\n- **Micro y peque√±as empresas** (identificadas en portal ESHOY): **15 d√≠as** desde la emisi√≥n del comprobante\n- **Resto de proveedores**: **30 d√≠as** desde la emisi√≥n del comprobante\n\n**Condiciones para el pago:**\n- El comprobante debe estar registrado y aprobado\n- Los pagos se programan los viernes\n\nüìß Consultas de pago: TesoreraAdministradora-Pagos@prima.com.pe\n\n---\n\n### Ejemplo 4: Pregunta sobre factura\n**Pregunta**: \"Tengo una factura, ¬øqu√© debo hacer?\"\n\n**Respuesta correcta**:\nPara procesar tu factura, sigue estos pasos:\n\n**Paso 1: Emisi√≥n y Env√≠o**\n- Env√≠a el comprobante al equipo de Compras\n- Incluye el n√∫mero de OC y documentos de soporte\n- ‚è∞ Plazo: m√°ximo 2 d√≠as despu√©s de la emisi√≥n\n- üí° Si requieres Factoring, comun√≠calo a tu contacto en Prima\n\n**Paso 2: Canalizaci√≥n a Tesorer√≠a**\n- Si la compra fue con Compras: ellos lo canalizan\n- Si fue sin Compras (l√≠neas 1, 8 o 9): enviar a Gesti√≥n del Gasto\n- Otras l√≠neas: usar herramienta adhoc (adjuntar PDF y XML)\n\n**Paso 3: Registro**\n- Tesorer√≠a registra en el sistema (m√°ximo 2 d√≠as)\n\n**Paso 4: Aprobaci√≥n**\n- El gestor responsable aprueba en EXACTUS (m√°ximo 2 d√≠as)\n\n**Paso 5: Pago**\n- Se programa el pago (los viernes)\n- Micro/peque√±as empresas: 15 d√≠as\n- Otros proveedores: 30 d√≠as\n\nüìß Registro: TesoreraAdministradora-Registros@prima.com.pe\nüìß Pagos: TesoreraAdministradora-Pagos@prima.com.pe"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        192,
        256
      ],
      "id": "e13ddc8b-5349-4379-b8d8-d6d46f9af6b1",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "description": "=Herramienta para buscar informaci√≥n en la Gu√≠a Operativa de Proveedores de PRIMA AFP. Usa esta herramienta SIEMPRE que el usuario pregunte sobre: procedimientos de compras, registro de proveedores, facturaci√≥n, pagos, plazos, documentaci√≥n requerida, contactos, o cualquier tema relacionado con ser proveedor de PRIMA AFP. Busca con palabras clave espec√≠ficas de la pregunta.",
        "topK": 8
      },
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1.1,
      "position": [
        304,
        464
      ],
      "id": "09846ef0-5cc0-48a0-b01d-6ede3c6424a4",
      "name": "pregunta"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        528,
        624
      ],
      "id": "dbe50ad5-aa8c-400f-8868-0135ba8d6c8f",
      "name": "llm",
      "credentials": {
        "openAiApi": {
          "id": "wC5k9nfhP8vKa1sp",
          "name": "openai_poc10"
        }
      }
    },
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "value": "rpc/match_documents",
          "mode": "list",
          "cachedResultName": "rpc/match_documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        224,
        624
      ],
      "id": "4175505c-e82b-4ecb-9142-e4b6b6ec5a5b",
      "name": "vector store",
      "credentials": {
        "supabaseApi": {
          "id": "aAdsCdfzM8DRX6Th",
          "name": "supabase_poc10"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "dimensions": 1536
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        224,
        768
      ],
      "id": "8cda0c05-721b-4b75-9298-b2d68e2a5371",
      "name": "embeddings",
      "credentials": {
        "openAiApi": {
          "id": "wC5k9nfhP8vKa1sp",
          "name": "openai_poc10"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        176,
        432
      ],
      "id": "6cffc9de-59cf-4ab5-be69-86effce024a5",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "wC5k9nfhP8vKa1sp",
          "name": "openai_poc10"
        }
      }
    },
    {
      "parameters": {
        "content": "# PRUEBAS",
        "height": 480,
        "width": 320,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        928,
        64
      ],
      "typeVersion": 1,
      "id": "d225934c-2f87-47a5-b2e8-3d3658ec6f27",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "# RAG\n\n## Herramienta que utiliza un vector storage para responder preguntas instructivas respecto a Gu√≠a Operativa para Proveedores dePRIMA AFP",
        "height": 816,
        "width": 1184
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -256,
        64
      ],
      "typeVersion": 1,
      "id": "5e090f77-414a-4ebb-805d-d5be8847b995",
      "name": "Sticky Note1"
    }
  ],
  "pinData": {},
  "connections": {
    "question": {
      "main": [
        []
      ]
    },
    "question_poc9": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "rpta": {
      "main": [
        []
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "rpta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "pregunta": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "llm": {
      "ai_languageModel": [
        [
          {
            "node": "pregunta",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "vector store": {
      "ai_vectorStore": [
        [
          {
            "node": "pregunta",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "embeddings": {
      "ai_embedding": [
        [
          {
            "node": "vector store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "36d7e293-9b50-404d-ae8b-a967d39e5e7a",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "0048be561be8ce8465645b9402273a44a270634fe9daeef83a17ba3f6be05638"
  },
  "id": "dFGtEcHhGJdw75rm",
  "tags": []
}